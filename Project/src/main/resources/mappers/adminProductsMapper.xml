<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.mappers.adminProductsMapper">
	<!-- ============================================ 상희 ============================================  -->
	<select id="getAllProductsCount" resultType="Integer">
		select count(*) FROM products
	</select>
	<select id="getProductsOnSaleCount">
		select count(*) from products where current_quantity > 0;
	</select>
	<select id="getOutOfStockProductsCount">
		select count(*) from products where current_quantity = 0;
	</select>
	<!-- ==============================================================================================  -->
	<!-- ============================================ 재용 ============================================  -->
	  <resultMap type="com.project.vodto.kjy.Products" id="allProductsSelectMap">
	  	<result property="productId" column="product_id"/>
	  	<result property="beforeProductId" column="product_id"/>
  		<result property="productName" column="product_name"/>
  		<result property="consumerPrice" column="consumer_price"/>
  		<result property="supplyPrice" column="supply_price"/>
  		<result property="sellingPrice" column="selling_price"/>
  		<result property="isbn" column="isbn"/>
  		<result property="productImage" column="product_image"/>
  		<result property="productInfoImage" column="product_info_image"/>
  		<result property="authorTranslator" column="author_translator"/>
  		<result property="originalAuthor" column="original_author"/>
  		<result property="illustrator" column="illustrator"/>
  		<result property="publisher" column="publisher"/>
  		<result property="publicationDate" column="publication_date"/>
  		<result property="pageCount" column="page_count"/>
  		<result property="size" column="size"/>
  		<result property="totalVolume" column="total_volume"/>
  		<result property="authorIntroduction" column="author_introduction"/>
  		<result property="introductionIntro" column="introduction_intro"/>
  		<result property="introductionDetail" column="introduction_detail"/>
  		<result property="tableOfContents" column="table_of_contents"/>
  		<result property="notificationSubscription" column="notification_subscription"/>
  		<result property="bestSellerStatus" column="best_seller_status"/>
  		<result property="categoryKey" column="category_key"/>
  		<result property="currentQuantity" column="current_quantity"/>
  		<collection property="productImages" ofType="String" column="product_images">
  			<result property="productImages" column="product_images" />
  		</collection>
	  </resultMap>
	  
	  <select id="selectProductInfoForAdmin" resultMap="allProductsSelectMap">
		select p.*, i.product_image as product_images from products p inner join product_images i on p.product_id = i.product_id; 
	  </select>
	  <select id="selectProductCategoriesForAdmin" resultType="com.project.vodto.kjy.Categories">
	  	SELECT c.* FROM categories c INNER JOIN category_paths p ON c.id = p.descendant WHERE p.ancestor = #{key};
	  </select>
	
	  <insert id="insertProductsForAdmin">
		  	insert into gott123.products(
		  		product_id, product_name, selling_price, consumer_price, supply_price, isbn, product_info_image, author_translator, original_author, illustrator, publisher, publication_date, page_count, size, total_volume, author_introduction, introduction_intro, introduction_detail, table_of_contents, category_key
	  		)values(
	  			#{productId}, #{productName}, #{sellingPrice}, #{consumerPrice}, #{supplyPrice}, #{isbn}, #{productInfoImage}, #{authorTranslator}, #{originalAuthor}, #{illustrator}, #{publisher}, #{publicationDate}, #{pageCount}, #{size}, #{totalVolume}, #{authorIntroduction}, #{introductionIntro}, #{introductionDetail}, #{tableOfContents}, #{categoryKey}
	  		)  
	  </insert>
	  <insert id="insertProductImagesForAdmin">
	  		insert into gott123.product_images(product_id, product_image) values	 		
	  		<foreach collection="uploadFiles" item="file" separator=",">
	  			(#{productId}, #{file.newFileName})
	  		</foreach>
	  </insert>
	  
	  <update id="updateProductProductForAdmin">
	  	update gott123.products set product_id = #{productId}, product_name = #{productName}, selling_price = #{sellingPrice}, consumer_price #{consumerPrice},supply_price = #{supplyPrice}, isbn = #{isbn}, product_info_image = #{productInfoImage},author_translator = #{authorTranslator},original_author = #{originalAuthor},illustrator = #{illustrator},publisher = #{publisher},publication_date = #{publicationDate},page_count = #{pageCount},size = #{size},total_volume = #{totalVolume},author_introduction = #{authorIntroduction},introduction_intro = #{introductionIntro},introduction_detail = #{introductionDetail},table_of_contents = #{tableOfContents},category_key = #{categoryKey} where product_id = #{beforeProductId}
	  </update>
	  
	  <select id="selectProductImageForAdmin" resultType="com.project.vodto.kjs.ProductImage">
	  	select product_image from gott123.product_images where product_id = #{productId};
	  </select>
	  <delete id="deleteProductImageForAdmin">
	  	delete from gott123.product_images where product_image = #{newFileName}
	  </delete>
	  <delete id="deleteProductImagesForAdmin">
	  	delete from gott123.product_images where product_image in
	  	<foreach collection="images" index="image" open="(" close=")" separator=",">
	  		#{image}
	  	</foreach> 
	  </delete>
	  <delete id="deleteProductForAdmin">
	  	delete from gott123.products where product_id = #{productId}
	  </delete>
	<!-- ==============================================================================================  -->
	<!-- ============================================ 진솔 ============================================  -->
	
	<!-- ==============================================================================================  -->
</mapper>